#!/bin/bash

git submodule init
git submodule update

# Define items that should be linked to ~/.config
config_items=(
  "karabiner"
  "nvim"
  "ghostty"
  "starship.toml"
  "borders"
  "bat"
  "eza"
  "lsd"
)

# Base ignore list (items that shouldn't be symlinked to home at all)
base_ignorelist=(
  "setup"
  "update"
  "README.md"
  "com.camthompson.macos.updateip.plist"
)

# Combine base ignore list with config items for the full ignore list
not_ignored() {
  local ignorelist=("${base_ignorelist[@]}" "${config_items[@]}")
  for i in "${ignorelist[@]}"; do
    if [ "$1" = "$i" ]; then
      return 1
    fi
  done
  return 0
}

# Create .config directory and link config items
mkdir -p "$HOME/.config"
for item in "${config_items[@]}"; do
  if [ -e "$PWD/$item" ]; then
    ln -sf "$PWD/$item" "$HOME/.config/$item"
  fi
done

# Link everything else to home directory with dot prefix
for f in *; do
  if not_ignored "$f"; then
    rm -rf "$HOME/.$f"
    ln -s "$PWD/$f" "$HOME/.$f"
  fi
done
